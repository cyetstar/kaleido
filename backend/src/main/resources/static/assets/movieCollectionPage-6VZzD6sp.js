import{b as I,c as P}from"./movieCollectionApi-dshEcrFJ.js";import{a as r,b as l,o as v,l as T,w as s,k as S,f as a,N as G,P as H,u as V,v as L,y as U,Z as j,$,c as b,e as d,g as w,t as q,a3 as Z,F as R,n as J,ab as K}from"./index-8V0LDlr9.js";const O={__name:"movieCollectionForm",emits:["save-complete"],setup(E,{expose:h,emit:k}){const g=k;let o=r(),t=r({});const u=()=>{o.value.reset(),o.value.show()},e=async()=>{I(t.value).then(i=>{i&&(H.success("操作成功"),g("save-complete"),o.value.hide())})};return h({create:u}),(i,m)=>{const y=l("h-input"),C=l("h-col"),x=l("h-form-modal");return v(),T(x,{ref_key:"formRef",ref:o,"label-col":{span:4},width:"600px",form:S(t),"onUpdate:form":m[1]||(m[1]=p=>G(t)?t.value=p:t=p),title:"电影合集",onSubmit:e},{default:s(()=>[a(C,{span:24},{default:s(()=>[a(y,{label:"豆瓣编号",value:S(t).doubanId,"onUpdate:value":m[0]||(m[0]=p=>S(t).doubanId=p),name:"doubanId"},null,8,["value"])]),_:1})]),_:1},8,["form"])}}},Q={class:"k-page-section"},W={class:"k-search-form"},X={class:"flex justify-between items-center"},Y={class:"flex justify-end items-center mt-4 mb-2"},ee={key:0},oe={key:1,class:"grid grid-cols-24 gap-6"},ne={__name:"movieCollectionPage",setup(E){const h=r(),k=V(),g=L(),o=r(),t=r(!0),u=r({}),e=r({records:[],pageNumber:0,pageSize:100});U(()=>{i()}),j(()=>{o.value.scrollTop=g.getScrollTop("movieCollection")}),$((c,n,f)=>{g.setScrollTop(o.value.scrollTop,"movieCollection"),f()});const i=()=>{t.value=!0;const c={pageNumber:e.value.pageNumber+1,pageSize:e.value.pageSize,searchCount:!0,...u.value};P(c).then(n=>{t.value=!1,e.value.records.push(...n.records),e.value.pageNumber=n.pageNumber,e.value.pageSize=n.pageSize,e.value.total=n.total})},m=()=>{e.value.pageNumber=0,e.value.records=[],i()},y=c=>{k.push({path:"/movie/movieCollection/view",query:{id:c}})},C=()=>{h.value.create()},x=()=>{K("movieCollectionSyncDoubanAll")},p=()=>{const c=o.value.clientHeight,n=o.value.scrollHeight,f=o.value.scrollTop;c+f>=n-50&&t.value!==!0&&i()};return(c,n)=>{const f=l("h-input"),M=l("a-form"),N=l("h-button"),B=l("a-space"),F=l("a-empty"),z=l("k-plex-image"),A=l("a-card-meta"),D=l("a-card");return v(),b(R,null,[d("section",Q,[d("div",W,[d("div",X,[a(M,{model:u.value},{default:s(()=>[a(f,{value:u.value.keyword,"onUpdate:value":n[0]||(n[0]=_=>u.value.keyword=_),placeholder:"关键字",search:"",enterButton:"",onSearch:m},null,8,["value"])]),_:1},8,["model"]),a(B,null,{default:s(()=>[a(N,{onClick:C},{default:s(()=>[w("新增合集")]),_:1}),a(N,{onClick:x},{default:s(()=>[w("同步豆列")]),_:1})]),_:1})]),d("div",Y,[d("div",null,"总记录数: "+q(e.value.total),1)])]),d("section",{ref_key:"refScrollGrid",ref:o,onScroll:p},[e.value.records.length===0?(v(),b("div",ee,[a(F,{image:S(Z).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(v(),b("div",oe,[(v(!0),b(R,null,J(e.value.records,_=>(v(),T(D,{key:_.id,class:"k-card col-span-4",bordered:!1},{cover:s(()=>[a(z,{class:"cursor-pointer",preview:!1,"plex-thumb":_.thumb,onClick:te=>y(_.id)},null,8,["plex-thumb","onClick"])]),default:s(()=>[a(A,{title:_.title},null,8,["title"])]),_:2},1024))),128))]))],544)]),a(O,{ref_key:"refMovieCollectionForm",ref:h},null,512)],64)}}};export{ne as default};
