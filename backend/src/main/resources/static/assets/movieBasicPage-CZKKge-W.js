import{a as Y}from"./movieBasicApi-t3o0u2-x.js";import{v as I,a as i,b as n,o as d,c as _,f as a,w as m,g as R,F as B,P as Z,G as J,u as K,y as W,Z as X,$ as ee,e as v,a1 as te,k as x,t as N,a2 as ae,l as z,z as oe,a3 as le,n as ne}from"./index-8V0LDlr9.js";import{a as se}from"./sysDictApi-CcooC7wW.js";import{_ as ce}from"./movieBasicSearchInfo-xUAeyP1z.js";import{C as re}from"./CloseCircleOutlined-9PBHFzJT.js";import"./movieBasicFileManage-wTrkUyzx.js";const ie={__name:"movieBasicDownloadFolder",emits:["match-success"],setup(T,{expose:h,emit:M}){const y=I(),u=i(),p=i(),k=()=>{const o=y.$state.config.movieLibraryPath.split("/");o[o.length-1]="import";const f=o.join("/");u.value.show(f)},g=()=>{if(u.value.selectedRows.length!==1){Z.error("请选择1条记录操作");return}let l=u.value.selectedRows[0];p.value.show(l,"path")},s=()=>{u.value.load()};return h({show:k}),(l,o)=>{const f=n("h-button"),w=n("k-file-modal");return d(),_(B,null,[a(w,{ref_key:"refFileModal",ref:u},{footer:m(()=>[a(f,{plain:"",type:"primary",disabled:u.value.selectedRows.length!==1,onClick:g},{default:m(()=>[R("搜索匹配 ")]),_:1},8,["disabled"])]),_:1},512),a(ce,{ref_key:"refMovieBasicSearchInfo",ref:p,onMatchSuccess:s},null,512)],64)}}},ue={class:"k-page-section"},pe={class:"k-search-form"},de={class:"flex justify-between items-center"},ve={class:"flex justify-between items-center mt-4 mb-2"},me={class:"flex items-center"},_e={key:0,href:"#"},fe={key:1,href:"#"},he={key:0},ye={key:1,class:"grid grid-cols-24 gap-6"},ge={class:"absolute top-0 left-0 m-2px"},Me={__name:"movieBasicPage",setup(T){const h=J(),M=K(),y=I();i(y.actions);const u=i([{label:"类型",value:"genreId",type:"movieGenre"},{label:"国家地区",value:"countryId",type:"movieCountry"},{label:"分级",value:"contentRating",type:"movieContentRating"},{label:"年代",value:"decade",type:"movieDecade"},{label:"年份",value:"year",type:"movieYear"},{label:"多文件",value:"multipleFiles",type:"sfbz"},{label:"低质量",value:"lowQuality",type:"sfbz"},{label:"国语配音",value:"mandarin",type:"sfbz"},{label:"无字幕",value:"noSubtitle",type:"sfbz"}]),p=i(),k=i(),g=i(!0),s=i({}),l=i({records:[],pageNumber:0,pageSize:50}),o=i({key:"",value:"",text:""}),f=(e,t,c)=>{s.value[e]=t,o.value.key=e,o.value.value=t,o.value.text=c},w=()=>{s.value[o.value.key]="",o.value.key="",o.value.value="",o.value.text=""},D=()=>{u.value.forEach(e=>{se(e.type).then(t=>{e.children=t.map(c=>({label:c.text,value:c.value}))})})};W(()=>{C(),D()}),X(()=>{if(p.value.scrollTop=y.getScrollTop("movie"),h.params.load){const e=h.params.actorId;e&&f("actorId",e,"演职员: "+h.params.actorName),S()}}),ee((e,t,c)=>{y.setScrollTop(p.value.scrollTop,"movie"),c()});const C=()=>{g.value=!0;const e={pageNumber:l.value.pageNumber+1,pageSize:l.value.pageSize,searchCount:!0,...s.value};Y(e).then(t=>{g.value=!1,l.value.records.push(...t.records),l.value.pageNumber=t.pageNumber,l.value.pageSize=t.pageSize,l.value.total=t.total})},S=()=>{l.value.pageNumber=0,l.value.records=[],C()},P=e=>{M.push({path:"/movie/movieBasic/view",query:{id:e}})},E=()=>{k.value.show()},G=(e,t)=>{f(e[0],e[1],t.map(c=>c.label).join(": ")),S()},L=()=>{w(),S()},V=()=>{const e=p.value.clientHeight,t=p.value.scrollHeight,c=p.value.scrollTop;e+c>=t-50&&g.value!==!0&&C()};return(e,t)=>{const c=n("h-input"),$=n("a-form"),b=n("k-action-button"),j=n("h-button"),A=n("a-space"),H=n("a-cascader"),O=n("a-empty"),U=n("k-thumb-image"),F=n("k-logo-link"),q=n("a-card-meta"),Q=n("a-card");return d(),_(B,null,[v("section",ue,[v("div",pe,[v("div",de,[a($,{model:s.value},{default:m(()=>[a(c,{value:s.value.keyword,"onUpdate:value":t[0]||(t[0]=r=>s.value.keyword=r),placeholder:"关键字",search:"",enterButton:"",onSearch:S},null,8,["value"])]),_:1},8,["model"]),a(A,null,{default:m(()=>[a(b,{action:"movieCheckThreadStatus","ok-text":"检测TLF","cancel-text":"取消检测",form:s.value},null,8,["form"]),a(b,{action:"movieAnalyze","ok-text":"分析文件","cancel-text":"取消分析",form:s.value},null,8,["form"]),a(b,{action:"movieUpdateSource","ok-text":"更新文件源","cancel-text":"取消更新"}),a(b,{action:"movieSync","ok-text":"同步Plex","cancel-text":"取消同步",form:s.value},null,8,["form"]),a(b,{action:"movieMatchInfo","ok-text":"自动抓取","cancel-text":"取消抓取",form:s.value},null,8,["form"]),a(j,{onClick:E},{default:m(()=>[R("文件源目录")]),_:1})]),_:1})]),v("div",ve,[v("div",me,[a(H,{value:o.value.value,"onUpdate:value":t[1]||(t[1]=r=>o.value.value=r),options:u.value,onChange:G},{default:m(()=>[x(te)(o.value.value)?(d(),_("a",_e,"筛选")):(d(),_("a",fe,N(o.value.text),1))]),_:1},8,["value","options"]),x(ae)(o.value.value)?(d(),z(x(re),{key:0,class:"ml-2 cursor-pointer",onClick:L})):oe("",!0)]),v("div",null,"总记录数: "+N(l.value.total),1)])]),v("section",{ref_key:"refScrollGrid",ref:p,onScroll:V},[l.value.records.length===0?(d(),_("div",he,[a(O,{image:x(le).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(d(),_("div",ye,[(d(!0),_(B,null,ne(l.value.records,r=>(d(),z(Q,{key:r.id,class:"k-card col-span-3",bordered:!1},{cover:m(()=>[a(U,{class:"h-poster",type:"MovieBasic",preview:!1,id:r.id,onClick:be=>P(r.id)},null,8,["id","onClick"]),v("div",ge,[a(F,{type:"plex",id:r.id,width:20,class:"mr-1"},null,8,["id"]),a(F,{type:"douban",id:r.doubanId,width:20},null,8,["id"])])]),default:m(()=>[a(q,{title:r.title,description:r.year},null,8,["title","description"])]),_:2},1024))),128))]))],544)]),a(ie,{ref_key:"refMovieBasicDownloadFolder",ref:k},null,512)],64)}}};export{Me as default};
