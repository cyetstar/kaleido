import{J,G as Z,u as j,v as K,a as d,y as Q,Z as U,$ as W,b as l,o as u,c as _,f as e,w as s,g as k,k as h,t as m,e as a,F as B,n as D,a2 as X,z as Y,ab as ee,P as N,l as oe,a1 as T,C as te}from"./index-8V0LDlr9.js";import{d as le,e as ae}from"./movieCollectionApi-dshEcrFJ.js";const ne=C=>J.get({url:"/movieBasicCollection/page",params:C}),se={class:"flex"},ce={class:"flex-1 ml-8"},ie={key:0,class:"flex"},re=a("span",{class:"mr-2"},"更新于:",-1),ue={class:"flex-1"},pe={class:"grid grid-cols-24 gap-6"},de={class:"absolute top-0 left-0 m-2px"},ve={__name:"movieCollectionView",setup(C){const I=Z(),y=j(),g=K(),v=I.query.id,r=d(),f=d(!0),c=d({}),z=d({collectionId:v}),i=d({records:[],pageNumber:0,pageSize:100}),V=async()=>{le({id:v}).then(o=>{c.value=o})},L=o=>{y.push({path:"/movie/movieBasic/view",query:{id:o}})},M=()=>{ee("movieCollectionSyncDouban",{id:v})},R=()=>{ae([v]).then(o=>{o?(N.success("删除成功"),y.push("/movie/movieCollection/page")):N.error("删除失败")})};Q(()=>{V(),x()}),U(()=>{r.value.scrollTop=g.getScrollTop("movieCollection")}),W((o,n,p)=>{g.setScrollTop(r.value.scrollTop,"movieCollection"),p()});const x=()=>{f.value=!0;const o={pageNumber:i.value.pageNumber+1,pageSize:i.value.pageSize,searchCount:!0,...z.value};ne(o).then(n=>{f.value=!1,i.value.records.push(...n.records),i.value.pageNumber=n.pageNumber,i.value.pageSize=n.pageSize,i.value.total=n.total})},F=()=>{const o=r.value.clientHeight,n=r.value.scrollHeight,p=r.value.scrollTop;o+p>=n-50&&f.value!==!0&&x()};return(o,n)=>{const p=l("LeftOutlined"),G=l("h-button-delete"),H=l("h-button"),A=l("a-space"),$=l("a-page-header"),S=l("k-plex-image"),b=l("k-logo-link"),q=l("h-module-title"),O=l("a-card-meta"),P=l("a-card"),E=l("a-tooltip");return u(),_("section",{class:"k-view-section",ref_key:"refScrollGrid",ref:r,onScroll:F},[e($,{title:c.value.title,onBack:n[0]||(n[0]=()=>o.$router.go(-1))},{backIcon:s(()=>[e(p)]),extra:s(()=>[e(A,null,{default:s(()=>[e(G,{onDelete:R},{default:s(()=>[k("删除")]),_:1}),e(H,{onClick:M},{default:s(()=>[k(m(h(g).actions.movieCollectionSyncDouban?"取消同步":"同步豆列"),1)]),_:1})]),_:1})]),_:1},8,["title"]),a("section",se,[a("div",null,[e(S,{style:{width:"250px"},"plex-thumb":c.value.thumb},null,8,["plex-thumb"])]),a("div",ce,[a("p",null,[(u(!0),_(B,null,D(c.value.summaryList,(t,w)=>(u(),_("p",{key:w},m(t),1))),128))]),h(X)(c.value.updateTime)?(u(),_("p",ie,[re,a("span",ue,m(c.value.updateTime),1)])):Y("",!0),a("p",null,[e(b,{type:"doulist",id:c.value.doubanId,class:"mr-3"},null,8,["id"])])])]),a("section",null,[e(q,{title:"电影"},{right:s(()=>[k(" 共"+m(c.value.childCount)+"部 ",1)]),_:1}),a("div",pe,[(u(!0),_(B,null,D(i.value.records,t=>(u(),oe(E,{key:t.id,title:t.comment},{default:s(()=>[e(P,{class:"k-card col-span-3",bordered:!1},{cover:s(()=>[e(S,{class:te(["h-thumb",h(T)(t.movieId)?null:"cursor-pointer"]),preview:!1,"plex-thumb":t.thumb,onClick:w=>h(T)(t.movieId)?null:L(t.movieId)},null,8,["class","plex-thumb","onClick"]),a("div",de,[e(b,{type:"plex",id:t.movieId,width:20,class:"mr-1"},null,8,["id"]),e(b,{type:"douban",id:t.doubanId,width:20},null,8,["id"])])]),default:s(()=>[e(O,{title:t.title},{description:s(()=>[a("div",null,m(t.year),1)]),_:2},1032,["title"])]),_:2},1024)]),_:2},1032,["title"]))),128))])])],544)}}};export{ve as default};
