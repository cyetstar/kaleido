import{a as u,b as i,o as v,l as S,w as l,g as p,f as o,c as z,a5 as E,e as m,t as I,a2 as B,k as U,z as C,F as G,P as V}from"./index-8V0LDlr9.js";import{f as H}from"./tvshowShowApi--6lP2oKh.js";import{f as J,g as O,h as Q}from"./tvshowSeasonApi-yL39YQBd.js";const W={__name:"tvshowSeasonFileManage",emits:["match-success"],setup(D,{expose:b,emit:T}){const w=u([]),h=u();let d=null,c=null;return b({show:r=>{d=r,J({id:d}).then(a=>{c=a,h.value.show(c)})}}),(r,a)=>{const y=i("h-button"),s=i("a-upload"),g=i("k-file-modal");return v(),S(g,{ref_key:"refFileModal",ref:h},{footer:l(()=>[o(s,{"file-list":w.value,"onUpdate:fileList":a[0]||(a[0]=k=>w.value=k),name:"file",showUploadList:!1,"custom-request":r.uploadFile},{default:l(()=>[o(y,{plain:"",type:"primary"},{default:l(()=>[p("上传海报")]),_:1})]),_:1},8,["file-list","custom-request"])]),_:1},512)}}},X={class:"flex gap-2"},Y=["href"],Z=["src"],ee=["href"],te={key:0,class:"text-muted"},oe={class:"text-muted"},ne={__name:"tvshowShowSearchInfo",emits:["match-success"],setup(D,{expose:b,emit:T}){const w=T,h=u(),d=u(),c=u(),_=u(),r=u([]),a=u({source:"douban",keyword:"",matchType:"path"}),y=[{text:"豆瓣",value:"douban"},{text:"TMDB",value:"tmdb"}];let s={};const g=(t,n)=>{s=t,r.value=[],_.value=!0,a.value.matchType=n,n==="path"?(d.value=s.name,a.value.keyword=s.name.replaceAll("."," ")):(d.value=s.title,a.value.keyword=s.showTitle+" "+s.title)},k=()=>{c.value=!0,H(a.value).then(t=>{r.value=t,c.value=!1})},N=t=>{h.value.show(t)},F=t=>{O({...s,...t,...a.value}).then(()=>{V.success("匹配成功"),_.value=!1,w("match-success")})},P=t=>{c.value=!0;let n=t.poster.replace("s_ratio_poster","m_ratio_poster");Q({id:s.id,url:n}).then(()=>{V.success("下载成功"),_.value=!1})},M=t=>{if(t.doubanId&&t.doubanId===s.doubanId||t.tmdbId&&t.tmdbId===s.tmdbId)return"bg-highlight"};return b({show:g,addRowColor:M}),(t,n)=>{const j=i("h-radio"),L=i("h-input"),f=i("h-button"),x=i("a-table-column"),q=i("k-logo-link"),K=i("a-space"),R=i("a-table"),A=i("a-modal");return v(),z(G,null,[o(A,{ref:"formRef",visible:_.value,"onUpdate:visible":n[2]||(n[2]=e=>_.value=e),title:`匹配【${d.value}】信息`,width:"960px",footer:null},{default:l(()=>[m("div",X,[o(j,{value:a.value.source,"onUpdate:value":n[0]||(n[0]=e=>a.value.source=e),button:"",name:"source",columns:y},null,8,["value"]),o(L,{class:"flex-1",placeholder:"",value:a.value.keyword,"onUpdate:value":n[1]||(n[1]=e=>a.value.keyword=e),name:"keyword",onKeyup:E(k,["enter"])},null,8,["value"]),o(f,{onClick:k},{default:l(()=>[p("搜索")]),_:1}),o(f,{onClick:F},{default:l(()=>[p("无法匹配")]),_:1})]),o(R,{size:"small","data-source":r.value,loading:c.value,"row-class-name":M,class:"mt-3"},{default:l(()=>[o(x,{title:"海报",align:"center",width:"150px"},{default:l(({record:e})=>[m("a",{href:`https://movie.douban.com/subject/${e.doubanId}/`,target:"_blank",class:"flex justify-center"},[m("img",{src:e.poster,width:80,referrerpolicy:"no-referrer"},null,8,Z)],8,Y)]),_:1}),o(x,{title:"剧集信息"},{default:l(({record:e})=>[m("p",null,[m("a",{href:`https://movie.douban.com/subject/${e.doubanId}/`,target:"_blank"},I(e.title),9,ee),o(q,{type:"plex",width:20,id:e.existId,class:"ml-3"},null,8,["id"])]),U(B)(e.originalTitle)?(v(),z("p",te,I(e.originalTitle),1)):C("",!0),m("div",oe,I(e.year),1)]),_:1}),o(x,{title:"操作",align:"center",width:"150px"},{default:l(({record:e})=>[o(K,{size:0},{default:l(()=>[U(B)(e.existId)?(v(),S(f,{key:0,type:"primary",size:"small",link:"",onClick:$=>N(e.existId)},{default:l(()=>[p("查看文件 ")]),_:2},1032,["onClick"])):C("",!0),o(f,{type:"primary",size:"small",link:"",onClick:$=>F(e)},{default:l(()=>[p("匹配 ")]),_:2},1032,["onClick"]),t.type!=="path"?(v(),S(f,{key:1,type:"primary",size:"small",link:"",onClick:$=>P(e)},{default:l(()=>[p("下载海报 ")]),_:2},1032,["onClick"])):C("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data-source","loading"])]),_:1},8,["visible","title"]),o(W,{ref_key:"refTvshowSeasonFileManage",ref:h},null,512)],64)}}};export{ne as _,W as a};
