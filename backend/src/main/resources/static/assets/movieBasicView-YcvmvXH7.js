import{_ as ae,a as w,b as v,o,c as d,f as e,w as l,k as a,N as j,F as _,a9 as H,l as m,n as x,g as k,e as c,P as J,u as le,G as ne,x as W,a2 as I,y as oe,a4 as se,z as f,t as L,aa as ue}from"./index-8V0LDlr9.js";import{b as Y,c as ie,d as re}from"./movieBasicApi-t3o0u2-x.js";import{a as de}from"./movieCollectionApi-dshEcrFJ.js";import{_ as ce}from"./movieBasicSearchInfo-xUAeyP1z.js";import{_ as pe}from"./movieBasicFileManage-wTrkUyzx.js";import{_ as ve}from"./actorForm-JIEKGh_E.js";import{M as X}from"./MinusOutlined-ga10JiA-.js";const me={__name:"movieBasicForm",emits:["save-complete"],setup(Z,{expose:V,emit:u}){const S=u;let T=w(),M=w("basic"),R=w("create"),B=w(),t=w({id:"",title:"",originalTitle:"",titleSort:"",year:"",thumb:"",art:"",userRating:"",summary:"",duration:"",contentRating:"",originallyAvailableAt:"",studio:"",rating:"",lastViewedAt:"",viewCount:"",imdb:"",doubanId:"",addedAt:"",updatedAt:""});const $=()=>{R.value="create",B.value.reset(),B.value.show()},N=async y=>{R.value="update",B.value.reset(),t.value=await Y({id:y}),t.value.directorList.length>0&&(t.value.directorList=t.value.directorList.map(s=>s.id)),t.value.writerList.length>0&&(t.value.writerList=t.value.writerList.map(s=>s.id)),B.value.show()},F=async()=>{try{R.value==="create"?await ie(t.value)&&(J.success("操作成功"),S("save-complete"),B.value.hide()):R.value==="update"&&(t.value.akaList=t.value.akaList.filter(s=>s!==""),await re(t.value)&&(J.success("操作成功"),S("save-complete"),B.value.hide()))}catch{}},D=y=>{y===0?t.value.actorList.push({id:"",playRole:""}):t.value.actorList.splice(y,1)},P=y=>{y===0?t.value.akaList.push(""):t.value.akaList.splice(y,1)},O=()=>{T.value.create()};return V({create:$,update:N}),(y,s)=>{const h=v("h-input"),i=v("h-col"),b=v("h-select"),g=v("a-tab-pane"),A=v("k-select-actor"),q=v("a-row"),z=v("a-tabs"),K=v("a-col"),G=v("h-form-modal");return o(),d(_,null,[e(G,{ref_key:"formRef",ref:B,"label-col":{span:4},width:"1000px",form:a(t),"onUpdate:form":s[17]||(s[17]=n=>j(t)?t.value=n:t=n),title:"电影",onSubmit:F},{default:l(()=>[e(K,{span:24},{default:l(()=>[e(z,{activeKey:a(M),"onUpdate:activeKey":s[16]||(s[16]=n=>j(M)?M.value=n:M=n),"tab-position":"left"},{default:l(()=>[e(g,{key:"basic",tab:"基本"},{default:l(()=>[e(i,{span:24},{default:l(()=>[e(h,{label:"标题",value:a(t).title,"onUpdate:value":s[0]||(s[0]=n=>a(t).title=n),name:"title"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"原标题",value:a(t).originalTitle,"onUpdate:value":s[1]||(s[1]=n=>a(t).originalTitle=n),name:"originalTitle"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"排序名",value:a(t).sortTitle,"onUpdate:value":s[2]||(s[2]=n=>a(t).sortTitle=n),name:"sortTitle"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"简介","text-area":"",rows:"4",value:a(t).summary,"onUpdate:value":s[3]||(s[3]=n=>a(t).summary=n),name:"summary"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"年份",value:a(t).year,"onUpdate:value":s[4]||(s[4]=n=>a(t).year=n),name:"year"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"评分",value:a(t).rating,"onUpdate:value":s[5]||(s[5]=n=>a(t).rating=n),name:"rating"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(b,{label:"评级",value:a(t).contentRating,"onUpdate:value":s[6]||(s[6]=n=>a(t).contentRating=n),"dict-type":"movieContentRating",name:"contentRating"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"IMDb编号",value:a(t).imdbId,"onUpdate:value":s[7]||(s[7]=n=>a(t).imdbId=n),name:"imdbId"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"豆瓣编号",value:a(t).doubanId,"onUpdate:value":s[8]||(s[8]=n=>a(t).doubanId=n),name:"doubanId"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(h,{label:"TMDB编号",value:a(t).tmdbId,"onUpdate:value":s[9]||(s[9]=n=>a(t).tmdbId=n),name:"tmdbId"},null,8,["value"])]),_:1})]),_:1}),e(g,{key:"authors",tab:"演职表"},{default:l(()=>[e(i,{span:24},{default:l(()=>[e(A,{value:a(t).directorList,"onUpdate:value":s[10]||(s[10]=n=>a(t).directorList=n),mode:"multiple",name:"directorList",label:"导演"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(A,{value:a(t).writerList,"onUpdate:value":s[11]||(s[11]=n=>a(t).writerList=n),mode:"multiple",name:"writerList",label:"编剧"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[(o(!0),d(_,null,x(a(t).actorList,(n,p)=>(o(),m(q,{key:p},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(A,{labelCol:{span:8},value:a(t).actorList[p].id,"onUpdate:value":U=>a(t).actorList[p].id=U,name:"form.actorList["+p+"].id",label:"主演"},null,8,["value","onUpdate:value","name"])]),_:2},1024),e(i,{span:12},{default:l(()=>[e(h,{value:a(t).actorList[p].playRole,"onUpdate:value":U=>a(t).actorList[p].playRole=U,name:"form.actorList["+p+"].playRole",label:"饰",search:"",onSearch:U=>D(p)},{enterButton:l(()=>[p===0?(o(),m(a(H),{key:0})):(o(),m(a(X),{key:1}))]),_:2},1032,["value","onUpdate:value","name","onSearch"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(i,{span:24,offset:"4"},{default:l(()=>[k("找不到？"),c("a",{onClick:O},"新增演职员")]),_:1})]),_:1}),e(g,{key:"tags",tab:"标签"},{default:l(()=>[e(i,{span:24},{default:l(()=>[e(b,{mode:"multiple",label:"国家地区",value:a(t).countryList,"onUpdate:value":s[12]||(s[12]=n=>a(t).countryList=n),dictType:"Country",name:"countryList"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(b,{mode:"multiple",label:"语言",value:a(t).languageList,"onUpdate:value":s[13]||(s[13]=n=>a(t).languageList=n),dictType:"Language",name:"languageList"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(b,{mode:"multiple",label:"类型",value:a(t).genreList,"onUpdate:value":s[14]||(s[14]=n=>a(t).genreList=n),dictType:"Genre",name:"genreList"},null,8,["value"])]),_:1}),e(i,{span:24},{default:l(()=>[e(b,{mode:"tags",label:"标签",value:a(t).tagList,"onUpdate:value":s[15]||(s[15]=n=>a(t).tagList=n),name:"tagList"},null,8,["value"])]),_:1})]),_:1}),e(g,{key:"akas",tab:"别名"},{default:l(()=>[e(i,{span:24},{default:l(()=>[(o(!0),d(_,null,x(a(t).akaList,(n,p)=>(o(),m(h,{key:p,label:"别名",value:a(t).akaList[p],"onUpdate:value":U=>a(t).akaList[p]=U,name:"aka"+p,search:"",onSearch:U=>P(p),allowClear:!1},{enterButton:l(()=>[p===0?(o(),m(a(H),{key:0})):(o(),m(a(X),{key:1}))]),_:2},1032,["value","onUpdate:value","name","onSearch"]))),128))]),_:1})]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1},8,["form"]),e(ve,{ref_key:"refActorForm",ref:T},null,512)],64)}}},_e=ae(me,[["__scopeId","data-v-2259d576"]]),fe={class:"k-view-section"},ye={class:"flex"},ke={class:"flex-1 ml-8"},be={key:0},ge={class:"flex items-center"},Le={key:0,class:"mr-2"},he={key:0,class:"flex"},xe=c("span",{class:"mr-2"},"导演:",-1),we={class:"flex-1"},Ue={key:0,class:"px-2"},Ce=["onClick"],Be={key:1,class:"flex"},Ie=c("span",{class:"mr-2"},"编剧:",-1),Me={class:"flex-1"},Re={key:0,class:"px-2"},Ae=["onClick"],Se={key:2,class:"flex"},Te=c("span",{class:"mr-2"},"又名:",-1),Fe={class:"flex-1"},Ve={key:0,class:"px-2"},$e={class:"flex"},Ne=c("span",{class:"mr-2"},"文件名:",-1),De={class:"flex-1"},Ke={class:"flex"},Pe=c("span",{class:"mr-2"},"更新于:",-1),Oe={class:"flex-1"},qe={key:0},ze={class:"grid grid-cols-24 gap-6"},Ge={key:1},Ee={class:"grid grid-cols-24 gap-6"},Ze={__name:"movieBasicView",setup(Z){const V=le(),u=w({}),S=w([]),T=w(),M=w(),R=w(),t=ne().query.id,$=W(()=>u.value.rating/2),N=W(()=>I(u.value.actorList)&&u.value.actorList.length>8?u.value.actorList.slice(0,8):u.value.actorList),F=w({id:t,force:!0}),D=async()=>{Y({id:t}).then(i=>{i.tagList=i.tagList.filter(b=>!i.countryList.some(g=>g.idLabel===b)&&!i.languageList.some(g=>g.idLabel===b)&&!i.genreList.some(g=>g.idLabel===b)),u.value=i}),de({movieId:t}).then(i=>{S.value=i.splice(0,8)})},P=()=>{M.value.show(t)},O=()=>{T.value.show(u.value)},y=i=>{V.push({name:"movieBasicPage",params:{actorId:i.id,actorName:i.name,load:!0}})},s=i=>{V.push({path:"/movie/movieCollection/view",query:{id:i}})},h=()=>{R.value.update(t)};return oe(()=>{D()}),(i,b)=>{const g=v("k-action-button"),A=v("h-button"),q=v("a-space"),z=v("a-page-header"),K=v("k-thumb-image"),G=v("a-rate"),n=v("a-tag"),p=v("k-logo-link"),U=v("h-module-title"),E=v("a-card-meta"),Q=v("a-card"),ee=v("k-plex-image");return o(),d(_,null,[c("section",fe,[e(z,{title:u.value.title,onBack:b[0]||(b[0]=()=>i.$router.go(-1))},{backIcon:l(()=>[e(a(se))]),extra:l(()=>[e(q,null,{default:l(()=>[e(g,{action:"movieAnalyze","ok-text":"分析文件","cancel-text":"取消分析",form:F.value},null,8,["form"]),e(g,{action:"movieSync","ok-text":"同步Plex","cancel-text":"取消同步",form:F.value},null,8,["form"]),e(g,{action:"movieMatchInfo","ok-text":"自动抓取","cancel-text":"取消抓取",form:F.value},null,8,["form"]),e(A,{onClick:O},{default:l(()=>[k("匹配抓取")]),_:1}),e(A,{onClick:h},{default:l(()=>[k("编辑")]),_:1}),e(A,{onClick:P},{default:l(()=>[k("文件管理")]),_:1})]),_:1})]),_:1},8,["title"]),c("section",ye,[c("div",null,[u.value.id?(o(),m(K,{key:0,class:"h-poster",type:"MovieBasic",style:{width:"250px"},id:u.value.id},null,8,["id"])):f("",!0)]),c("div",ke,[c("p",null,[k(L(u.value.originalTitle)+" ",1),a(I)(u.value.year)?(o(),d("span",be,"("+L(u.value.year)+")",1)):f("",!0)]),c("p",ge,[a(I)(u.value.rating)?(o(),d("span",Le,L(u.value.rating)+" 分",1)):f("",!0),e(G,{value:$.value,"onUpdate:value":b[1]||(b[1]=r=>$.value=r),disabled:"","allow-half":""},null,8,["value"])]),c("p",null,[u.value.contentRating?(o(),m(n,{key:0},{default:l(()=>[k(L(u.value.contentRating),1)]),_:1})):f("",!0),u.value.multipleFiles==="1"?(o(),m(n,{key:1},{default:l(()=>[k("多文件")]),_:1})):f("",!0),u.value.noSubtitle==="1"?(o(),m(n,{key:2},{default:l(()=>[k("无字幕")]),_:1})):f("",!0),u.value.lowQuality==="1"?(o(),m(n,{key:3},{default:l(()=>[k("低质量")]),_:1})):f("",!0),u.value.mandarin==="1"?(o(),m(n,{key:4},{default:l(()=>[k("国语配音")]),_:1})):f("",!0),(o(!0),d(_,null,x(u.value.countryList,r=>(o(),m(n,{key:r},{default:l(()=>[k(L(r),1)]),_:2},1024))),128)),(o(!0),d(_,null,x(u.value.genreList,r=>(o(),m(n,{key:r},{default:l(()=>[k(L(r),1)]),_:2},1024))),128)),(o(!0),d(_,null,x(u.value.languageList,r=>(o(),m(n,{key:r},{default:l(()=>[k(L(r),1)]),_:2},1024))),128)),(o(!0),d(_,null,x(u.value.tagList,r=>(o(),m(n,{key:r},{default:l(()=>[k(L(r),1)]),_:2},1024))),128))]),c("p",null,[(o(!0),d(_,null,x(u.value.summaryList,(r,C)=>(o(),d("p",{key:C},L(r),1))),128))]),a(I)(u.value.directorList)?(o(),d("p",he,[xe,c("span",we,[(o(!0),d(_,null,x(u.value.directorList,(r,C)=>(o(),d(_,null,[C!==0?(o(),d("span",Ue,"/")):f("",!0),c("a",{onClick:te=>y(r)},L(r.name),9,Ce)],64))),256))])])):f("",!0),a(I)(u.value.writerList)?(o(),d("p",Be,[Ie,c("span",Me,[(o(!0),d(_,null,x(u.value.writerList,(r,C)=>(o(),d(_,null,[C!==0?(o(),d("span",Re,"/")):f("",!0),c("a",{onClick:te=>y(r)},L(r.name),9,Ae)],64))),256))])])):f("",!0),a(I)(u.value.akaList)?(o(),d("p",Se,[Te,c("span",Fe,[(o(!0),d(_,null,x(u.value.akaList,(r,C)=>(o(),d(_,null,[C!==0?(o(),d("span",Ve,"/")):f("",!0),k(" "+L(r),1)],64))),256))])])):f("",!0),c("p",$e,[Ne,c("span",De,L(u.value.filename),1)]),c("p",Ke,[Pe,c("span",Oe,L(a(ue)(u.value.updatedAt)),1)]),c("p",null,[e(p,{type:"plex",id:u.value.id,class:"mr-3"},null,8,["id"]),e(p,{type:"imdb",id:u.value.imdbId,class:"mr-3"},null,8,["id"]),e(p,{type:"tmdb",id:u.value.tmdbId,class:"mr-3"},null,8,["id"]),e(p,{type:"douban",id:u.value.doubanId,class:"mr-3"},null,8,["id"])])])]),a(I)(N.value)?(o(),d("section",qe,[e(U,{title:"主演"}),c("div",ze,[(o(!0),d(_,null,x(N.value,r=>(o(),m(Q,{key:r.id,class:"k-card col-span-3",bordered:!1},{cover:l(()=>[e(K,{class:"h-thumb",preview:!1,url:r.thumb,onClick:C=>y(r)},null,8,["url","onClick"])]),default:l(()=>[e(E,{title:r.name,description:r.playRole},null,8,["title","description"])]),_:2},1024))),128))])])):f("",!0),a(I)(S.value)?(o(),d("section",Ge,[e(U,{title:"合集"}),c("div",Ee,[(o(!0),d(_,null,x(S.value,r=>(o(),m(Q,{key:r.id,class:"k-card col-span-4",bordered:!1},{cover:l(()=>[e(ee,{class:"cursor-pointer",preview:!1,"plex-thumb":r.thumb,onClick:C=>s(r.id)},null,8,["plex-thumb","onClick"])]),default:l(()=>[e(E,{title:r.title},null,8,["title"])]),_:2},1024))),128))])])):f("",!0)]),e(ce,{ref_key:"refMovieBasicSearchInfo",ref:T,onMatchSuccess:D},null,512),e(pe,{ref_key:"refMovieBasicFileManage",ref:M},null,512),e(_e,{ref_key:"refMovieBasicForm",ref:R},null,512)],64)}}};export{Ze as default};
