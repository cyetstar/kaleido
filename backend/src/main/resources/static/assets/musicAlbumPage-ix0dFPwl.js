import{v as P,a as m,b as s,o as u,c as f,f as e,w as _,g as T,F as A,P as q,u as K,y as Z,Z as J,$ as Q,e as p,a0 as w,a1 as W,k as x,t as N,a2 as X,l as D,z as Y,a3 as ee,n as te}from"./index-8V0LDlr9.js";import{a as oe}from"./musicAlbumApi-CiX1Qw26.js";import{a as ae}from"./sysDictApi-CcooC7wW.js";import{_ as le}from"./musicAlbumSearchInfo-KuB437q0.js";import{C as se}from"./CloseCircleOutlined-9PBHFzJT.js";const ne={__name:"musicAlbumDownloadFolder",emits:["match-success"],setup(E,{expose:M,emit:k}){const v=P(),a=m(),h=m(),n=()=>{const d=v.$state.config.musicLibraryPath.split("/");d[d.length-1]="import";const b=d.join("/");a.value.show(b)},g=()=>{if(a.value.selectedRows.length!==1){q.error("请选择1条记录操作");return}let r=a.value.selectedRows[0];h.value.show(r,"path")},l=()=>{a.value.load()};return M({show:n}),(r,d)=>{const b=s("h-button"),y=s("k-file-modal");return u(),f(A,null,[e(y,{ref_key:"refFileModal",ref:a},{footer:_(()=>[e(b,{plain:"",type:"primary",disabled:a.value.selectedRows.length!==1,onClick:g},{default:_(()=>[T("搜索匹配 ")]),_:1},8,["disabled"])]),_:1},512),e(le,{ref_key:"refMusicAlbumSearchInfo",ref:h,onMatchSuccess:l},null,512)],64)}}},ce={class:"k-page-section"},re={class:"k-search-form"},ie={class:"flex justify-between items-center"},ue={class:"flex justify-between items-center mt-4 mb-2"},me={class:"flex items-center"},de={key:0,href:"#"},pe={key:1,href:"#"},_e={key:0},fe={key:1,class:"grid grid-cols-24 gap-6"},ve={class:"absolute top-0 left-0 m-2px"},we={__name:"musicAlbumPage",setup(E){const M=K(),k=P(),v=m([{label:"类型",value:"genre"},{label:"年代",value:"decade"},{label:"年份",value:"year"}]),a=m(),h=m(),n=m({}),g=m(!1),l=m({records:[],pageNumber:0,pageSize:100}),r=m();Z(()=>{d(),R()}),J(()=>{a.value.scrollTop=k.getScrollTop("music")}),Q((t,o,i)=>{k.setScrollTop(a.value.scrollTop,"music"),i()});const d=()=>{g.value=!0;const t={pageNumber:l.value.pageNumber+1,pageSize:l.value.pageSize,searchCount:!0,...n.value};oe(t).then(o=>{g.value=!1,l.value.records.push(...o.records),l.value.pageNumber=o.pageNumber,l.value.pageSize=o.pageSize,l.value.total=o.total})},b=()=>{h.value.show()},y=()=>{l.value.pageNumber=0,l.value.records=[],d()},B=t=>{M.push({path:"/music/musicAlbum/view",query:{id:t}})},R=()=>{v.value.forEach(t=>{let o=k.$state.config.plexMusicLibraryId+t.value;ae(o).then(i=>{t.children=i.map(S=>({label:S.text,value:S.value}))})})},C=()=>{r.value=null,v.value.forEach(t=>{n.value[t.value]=null})},I=(t,o)=>{C(),r.value=o.map(i=>i.label).join(" : "),n.value[t[0]]=t[1],y()},L=()=>{C(),y()},z=()=>{const t=a.value.clientHeight,o=a.value.scrollHeight,i=a.value.scrollTop;t+i>=o-50&&g.value!==!0&&d()};return(t,o)=>{const i=s("h-input"),S=s("a-form"),$=s("h-button"),V=s("a-space"),j=s("a-cascader"),G=s("a-empty"),H=s("k-thumb-image"),F=s("k-logo-link"),O=s("a-card-meta"),U=s("a-card");return u(),f(A,null,[p("section",ce,[p("div",re,[p("div",ie,[e(S,{model:n.value},{default:_(()=>[e(i,{value:n.value.keyword,"onUpdate:value":o[0]||(o[0]=c=>n.value.keyword=c),placeholder:"关键字",search:"",enterButton:"",onSearch:y},null,8,["value"])]),_:1},8,["model"]),e(V,null,{default:_(()=>[e(w,{action:"musicDownloadLyric","ok-text":"下载歌词","cancel-text":"取消下载",form:n.value},null,8,["form"]),e(w,{action:"musicUpdateSource","ok-text":"更新文件源","cancel-text":"取消更新"}),e(w,{action:"musicSync","ok-text":"同步Plex","cancel-text":"取消同步",form:n.value},null,8,["form"]),e(w,{action:"musicMatchInfo","ok-text":"自动抓取","cancel-text":"取消抓取",form:n.value},null,8,["form"]),e($,{onClick:b},{default:_(()=>[T("文件源目录")]),_:1})]),_:1})]),p("div",ue,[p("div",me,[e(j,{options:v.value,onChange:I},{default:_(()=>[x(W)(r.value)?(u(),f("a",de,"筛选")):(u(),f("a",pe,N(r.value),1))]),_:1},8,["options"]),x(X)(r.value)?(u(),D(x(se),{key:0,class:"ml-2 cursor-pointer",onClick:L})):Y("",!0)]),p("div",null,"总记录数: "+N(l.value.total),1)])]),p("section",{ref_key:"refScrollGrid",ref:a,onScroll:z},[l.value.records.length===0?(u(),f("div",_e,[e(G,{image:x(ee).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(u(),f("div",fe,[(u(!0),f(A,null,te(l.value.records,c=>(u(),D(U,{key:c.id,class:"k-card col-span-3",bordered:!1},{cover:_(()=>[e(H,{class:"h-cover",type:"MusicAlbum",preview:!1,id:c.id,onClick:he=>B(c.id)},null,8,["id","onClick"]),p("div",ve,[e(F,{type:"plex",id:c.id,width:20,class:"mr-1"},null,8,["id"]),e(F,{type:"netease",id:c.neteaseId,width:20},null,8,["id"])])]),default:_(()=>[e(O,{title:c.title,description:c.artists||"-- ("+(c.originallyAvailableAt||"?")+")"},null,8,["title","description"])]),_:2},1024))),128))]))],544)]),e(ne,{ref_key:"refMusicAlbumDownloadFolder",ref:h},null,512)],64)}}};export{we as default};
