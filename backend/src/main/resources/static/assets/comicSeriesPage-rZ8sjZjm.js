import{a as Q}from"./comicSeriesFileManage-joA7-t-O.js";import{v as M,a as i,b as c,o as p,c as v,f as o,w as _,g as T,F,G as Y,u as Z,y as J,Z as W,$ as X,e as m,a0 as x,a1 as ee,k as S,t as D,a2 as te,l as R,z as oe,a3 as ae,n as le}from"./index-8V0LDlr9.js";import{a as se}from"./sysDictApi-CcooC7wW.js";import{_ as ce}from"./comicSeriesSearchInfo-zXohGcel.js";import{C as ne}from"./CloseCircleOutlined-9PBHFzJT.js";const re={__name:"comicSeriesDownloadFolder",emits:["match-success"],setup(E,{expose:g,emit:N}){const f=M(),d=i(),u=i(),b=()=>{const t=f.$state.config.comicLibraryPath.split("/");t[t.length-1]="import";const y=t.join("/");d.value.show(y)},h=()=>{let l=d.value.selectedRows;u.value.show(l[0],"path")},n=()=>{d.value.load()};return g({show:b}),(l,t)=>{const y=c("h-button"),C=c("k-file-modal");return p(),v(F,null,[o(C,{ref_key:"refFileModal",ref:d},{footer:_(()=>[o(y,{disabled:d.value.selectedRows.length!==1,plain:"",type:"primary",onClick:h},{default:_(()=>[T("匹配搜索 ")]),_:1},8,["disabled"])]),_:1},512),o(ce,{ref_key:"refComicSeriesSearchInfo",ref:u,onMatchSuccess:n},null,512)],64)}}},ie={class:"k-page-section"},ue={class:"k-search-form"},pe={class:"flex justify-between items-center"},de={class:"flex justify-between items-center mt-4 mb-2"},me={class:"flex items-center"},_e={key:0,href:"#"},ve={key:1,href:"#"},fe={key:0},he={key:1,class:"grid grid-cols-24 gap-6"},ye={class:"absolute top-0 left-0 m-2px"},xe={__name:"comicSeriesPage",setup(E){const g=Y(),N=Z(),f=M();i(f.actions);const d=i([{label:"类型",value:"genreId",type:"comicGenre"},{label:"国家地区",value:"countryId",type:"comicCountry"},{label:"分级",value:"contentRating",type:"comicContentRating"},{label:"年代",value:"decade",type:"comicDecade"},{label:"年份",value:"year",type:"comicYear"},{label:"多文件",value:"multipleFiles",type:"sfbz"},{label:"低质量",value:"lowQuality",type:"sfbz"},{label:"国语配音",value:"mandarin",type:"sfbz"},{label:"无字幕",value:"noSubtitle",type:"sfbz"}]),u=i(),b=i(),h=i(!0),n=i({}),l=i({records:[],pageNumber:0,pageSize:50}),t=i({key:"",value:"",text:""}),y=(a,e,s)=>{n.value[a]=e,t.value.key=a,t.value.value=e,t.value.text=s},C=()=>{n.value[t.value.key]="",t.value.key="",t.value.value="",t.value.text=""},I=()=>{d.value.forEach(a=>{se(a.type).then(e=>{a.children=e.map(s=>({label:s.text,value:s.value}))})})};J(()=>{w(),I()}),W(()=>{u.value.scrollTop=f.getScrollTop("comic"),g.params.load&&(n.value.keyword=g.params.keyword,k())}),X((a,e,s)=>{f.setScrollTop(u.value.scrollTop,"comic"),s()});const w=()=>{h.value=!0;const a={pageNumber:l.value.pageNumber+1,pageSize:l.value.pageSize,searchCount:!0,...n.value};Q(a).then(e=>{h.value=!1,l.value.records.push(...e.records),l.value.pageNumber=e.pageNumber,l.value.pageSize=e.pageSize,l.value.total=e.total})},k=()=>{l.value.pageNumber=0,l.value.records=[],w()},P=a=>{N.push({path:"/comic/comicSeries/view",query:{id:a}})},B=()=>{b.value.show()},G=(a,e)=>{y(a[0],a[1],e.map(s=>s.label).join(": ")),k()},L=()=>{C(),k()},V=()=>{const a=u.value.clientHeight,e=u.value.scrollHeight,s=u.value.scrollTop;a+s>=e-50&&h.value!==!0&&w()};return(a,e)=>{const s=c("h-input"),$=c("a-form"),j=c("h-button"),A=c("a-space"),H=c("a-cascader"),O=c("a-empty"),U=c("k-thumb-image"),z=c("k-logo-link"),K=c("a-card-meta"),q=c("a-card");return p(),v(F,null,[m("section",ie,[m("div",ue,[m("div",pe,[o($,{model:n.value},{default:_(()=>[o(s,{value:n.value.keyword,"onUpdate:value":e[0]||(e[0]=r=>n.value.keyword=r),placeholder:"关键字",search:"","enter-button":"",onSearch:k},null,8,["value"])]),_:1},8,["model"]),o(A,null,{default:_(()=>[o(x,{action:"comicUpdateSource","ok-text":"更新文件源","cancel-text":"取消更新"}),o(x,{action:"comicSync","ok-text":"同步Komga","cancel-text":"取消同步",form:n.value},null,8,["form"]),o(x,{action:"comicMatchInfo","ok-text":"自动抓取","cancel-text":"取消抓取",form:n.value},null,8,["form"]),o(j,{onClick:B},{default:_(()=>[T("文件源目录")]),_:1})]),_:1})]),m("div",de,[m("div",me,[o(H,{value:t.value.value,"onUpdate:value":e[1]||(e[1]=r=>t.value.value=r),options:d.value,onChange:G},{default:_(()=>[S(ee)(t.value.value)?(p(),v("a",_e,"筛选")):(p(),v("a",ve,D(t.value.text),1))]),_:1},8,["value","options"]),S(te)(t.value.value)?(p(),R(S(ne),{key:0,class:"ml-2 cursor-pointer",onClick:L})):oe("",!0)]),m("div",null,"总记录数: "+D(l.value.total),1)])]),m("section",{ref_key:"refScrollGrid",ref:u,onScroll:V},[l.value.records.length===0?(p(),v("div",fe,[o(O,{image:S(ae).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(p(),v("div",he,[(p(!0),v(F,null,le(l.value.records,r=>(p(),R(q,{key:r.id,class:"k-card col-span-3",bordered:!1},{cover:_(()=>[o(U,{class:"h-poster",type:"ComicSeries",preview:!1,id:r.id,onClick:ge=>P(r.id)},null,8,["id","onClick"]),m("div",ye,[o(z,{type:"komga",sub:"series",id:r.id,width:20,class:"mr-1"},null,8,["id"]),o(z,{type:"bgm",id:r.bgmId,width:20},null,8,["id"])])]),default:_(()=>[o(K,{title:r.title,description:r.year},null,8,["title","description"])]),_:2},1024))),128))]))],544)]),o(re,{ref_key:"refComicSeriesDownloadFolder",ref:b},null,512)],64)}}};export{xe as default};
