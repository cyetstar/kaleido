import{v as P,a as p,b as s,o as u,c as v,f as e,w as h,g as B,F,u as q,y as K,Z,$ as J,e as _,a0 as C,a1 as Q,k as S,t as E,a2 as W,l as M,z as X,a3 as Y,n as ee}from"./index-8V0LDlr9.js";import{a as oe}from"./tvshowShowApi--6lP2oKh.js";import{a as te}from"./sysDictApi-CcooC7wW.js";import{_ as ae}from"./tvshowShowSearchInfo-YTwu-1r9.js";import{C as le}from"./CloseCircleOutlined-9PBHFzJT.js";import"./tvshowSeasonApi-yL39YQBd.js";const se={__name:"tvshowShowDownloadFolder",emits:["match-success"],setup(R,{expose:b,emit:y}){const m=P(),l=p(),f=p(),n=()=>{const d=m.$state.config.tvshowLibraryPath.split("/");d[d.length-1]="import";const g=d.join("/");l.value.show(g)},w=()=>{let c=l.value.selectedRows[0];f.value.show(c,"path")},a=()=>{l.value.load()};return b({show:n}),(c,d)=>{const g=s("h-button"),x=s("k-file-modal");return u(),v(F,null,[e(x,{ref_key:"refFileModal",ref:l},{footer:h(()=>[e(g,{plain:"",disabled:l.value.selectedRows.length!==1,type:"primary",onClick:w},{default:h(()=>[B("匹配搜索")]),_:1},8,["disabled"])]),_:1},512),e(ae,{ref_key:"refTvshowShowSearchInfo",ref:f,onMatchSuccess:a},null,512)],64)}}},ne={class:"k-page-section"},ce={class:"k-search-form"},re={class:"flex justify-between items-center"},ie={class:"flex justify-between items-center mt-4 mb-2"},ue={class:"flex items-center"},pe={key:0,href:"#"},de={key:1,href:"#"},_e={key:0},he={key:1,class:"grid grid-cols-24 gap-6"},ve={class:"absolute top-0 left-0 m-2px"},be={__name:"tvshowShowPage",setup(R){const b=q(),y=P(),m=p([{label:"类型",value:"genre"},{label:"分级",value:"contentRating"},{label:"年份",value:"year"}]),l=p(),f=p(),n=p({}),w=p(!1),a=p({records:[],pageNumber:0,pageSize:36}),c=p();K(()=>{T(),I()}),Z(()=>{l.value.scrollTop=y.getScrollTop("tvshow")}),J((o,t,r)=>{y.setScrollTop(l.value.scrollTop,"tvshow"),r()});const d=()=>{a.value.pageNumber=0,a.value.records=[],T()},g=()=>{f.value.show()},x=o=>{b.push({path:"/tvshow/tvshowShow/view",query:{id:o}})},I=()=>{m.value.forEach(o=>{let t=y.$state.config.plexTvshowLibraryId+o.value;te(t).then(r=>{o.children=r.map(k=>({label:k.text,value:k.value}))})})},N=()=>{c.value=null,m.value.forEach(o=>{n.value[o.value]=null})},z=(o,t)=>{N(),c.value=t.map(r=>r.label).join(" : "),n.value[o[0]]=o[1],d()},L=()=>{N(),d()},$=()=>{const o=l.value.clientHeight,t=l.value.scrollHeight,r=l.value.scrollTop;o+r>=t-50&&w.value!==!0&&T()},T=()=>{w.value=!0;const o={pageNumber:a.value.pageNumber+1,pageSize:a.value.pageSize,searchCount:!0,...n.value};oe(o).then(t=>{w.value=!1,a.value.records.push(...t.records),a.value.pageNumber=t.pageNumber,a.value.pageSize=t.pageSize,a.value.total=t.total})};return(o,t)=>{const r=s("h-input"),k=s("a-form"),V=s("h-button"),j=s("a-space"),A=s("a-cascader"),G=s("a-empty"),H=s("k-thumb-image"),D=s("k-logo-link"),O=s("a-card-meta"),U=s("a-card");return u(),v(F,null,[_("section",ne,[_("div",ce,[_("div",re,[e(k,{model:n.value},{default:h(()=>[e(r,{value:n.value.keyword,"onUpdate:value":t[0]||(t[0]=i=>n.value.keyword=i),placeholder:"关键字",search:"",enterButton:"",onSearch:d},null,8,["value"])]),_:1},8,["model"]),e(j,null,{default:h(()=>[e(C,{action:"tvshowUpdateSource","ok-text":"更新文件源","cancel-text":"取消更新"}),e(C,{action:"tvshowSync","ok-text":"同步Plex","cancel-text":"取消同步",form:n.value},null,8,["form"]),e(C,{action:"movieMatchInfo","ok-text":"自动抓取","cancel-text":"取消抓取",form:n.value},null,8,["form"]),e(V,{onClick:g},{default:h(()=>[B("文件源目录")]),_:1})]),_:1})]),_("div",ie,[_("div",ue,[e(A,{options:m.value,onChange:z},{default:h(()=>[S(Q)(c.value)?(u(),v("a",pe,"筛选")):(u(),v("a",de,E(c.value),1))]),_:1},8,["options"]),S(W)(c.value)?(u(),M(S(le),{key:0,class:"ml-2 cursor-pointer",onClick:L})):X("",!0)]),_("div",null,"总记录数: "+E(a.value.total),1)])]),_("section",{ref_key:"refScrollGrid",ref:l,onScroll:$},[a.value.records.length===0?(u(),v("div",_e,[e(G,{image:S(Y).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(u(),v("div",he,[(u(!0),v(F,null,ee(a.value.records,i=>(u(),M(U,{key:i.id,class:"k-card col-span-3",bordered:!1},{cover:h(()=>[e(H,{class:"h-poster",type:"TvshowShow",preview:!1,id:i.id,onClick:me=>x(i.id)},null,8,["id","onClick"]),_("div",ve,[e(D,{type:"plex",id:i.id,width:20,class:"mr-1"},null,8,["id"]),e(D,{type:"douban",id:i.doubanId,width:20},null,8,["id"])])]),default:h(()=>[e(O,{title:i.title,description:i.year},null,8,["title","description"])]),_:2},1024))),128))]))],544)]),e(se,{ref_key:"refTvshowShowDownloadFolder",ref:f},null,512)],64)}}};export{be as default};
